FROM node:20-bookworm-slim AS build
WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine
RUN rm -rf /usr/share/nginx/html/*

# Copia el build del navegador (ya vimos en tu log que esta ruta S√ç existe)
COPY --from=build /app/dist/AppFront/browser/ /usr/share/nginx/html/

# Angular SSR te genera index.csr.html; para Nginx lo renombramos a index.html
RUN if [ -f /usr/share/nginx/html/index.csr.html ]; then mv /usr/share/nginx/html/index.csr.html /usr/share/nginx/html/index.html; fi

COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
